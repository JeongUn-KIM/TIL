# 웹 애플리케이션

웹페이지를 만들어내는 파일들의 모음

*.html + *.java + *.jsp + *.xml + sql ...

**web application 형태 규칙**

1. web application = web context = dynamic web project

2.  java resources - src -> 자바소스파일 저장(**servlet**)

   webcontent - web INF 폴더/ **web INF .xml** - * .html ,  .*** jsp** , images.jpg , * .css
   
   

**http 프로토콜 규칙**

1. url 구조를 이용하여 요청 : (주소표시줄 직접 입력) + (form 태그 자동 변경) url?파라미터명=값&....
2. 클라이언트에서 서버로 데이터 전송 방식 설정 태그
   < form action="서블릿 url" method="get(기본)|post" >
3. get : url 뒤 전송 데이터 o / post : url 뒤 전송 데이터 x
4. 첫번째 요청 - 연결생성 - 처리 - 응답 - 연결해제 (요청/응답 객체 삭제)
   두번째 요청 - 첫번쨰 요청 정보 서버에 존재 x
5. http 프로토콜 서버는 모든 클라이언트 정보를 서버에 남기지 않는다.
   => 1개의 서버가 다수의 클라이언트 처리 = 메모리 한계, 속도 저하
   
   

#### **http 프로토콜 응답/오류코드**

| 200, 300 | 정상 실행, 정상 결과 응답                                    |
| -------- | ------------------------------------------------------------ |
| **404**  | **Servlet, jsp**<br />   url  지정파일 없다<br />   서블릿 url 매핑오류<br />   파일명 오류<br />**Spring** <br />   @RequestMapping, @Controller 확인<br />   jsp 파일 존재 확인 |
| **405**  | **Servlet**<br />get --> doPost() 메소드처리<br />do --> doGet() 메소드처리<br />**jsp**<br />상기 get, post 문제 동일<br /> |
| **400**  | **Spring**<br />@RequestMapping()에서<br />   매핑 메소드의 매개변수가 form 전달 데이터 타입과 일치하지 않을 때<br />   ex) int ==> "aaaa"  같은 경우 |
| **500**  | **서블릿 실행 오류들**<br />오류이름, 메시지, 라인번호       |



**Servlet java 파일 정의 후, tomcat에 서버설정 알려주는 방법 2가지**

=> 서블릿 매핑하는 방법

1> **@WebServlet("/url매핑값")** -- 3.0 이상

​		class 서블릿 extends HttpServlet

​		doGet 오버라이딩

2> web.xml

​		class 서블릿 extends HttpServlet

​		doGet 오버라이딩

```xml
<servlet>
  <servlet-name>t</servlet-name>
  <servlet-class>test.TestServlet</servlet-class>
</servlet>

<servlet-mapping>
  <servlet-name>t</servlet-name>
  <url-pattern>/test</url-pattern>
</servlet-mapping>
```

# Servlet 서블릿

=> server side java program

html - client side markup language program

1. 


| Servlet                   |                                                              |
| ------------------------- | ------------------------------------------------------------ |
| 작성                      | url 매핑  : **@WebServlet("/a")** -> webservlet 어노테이션<br />**class A extends HttpServlet<br />doGet / doPost** 중 하나의 메소드 필수 구현<br />오버라이딩<br />==> web.xml 파일 대신 설정 |
| 실행                      | http://ip:port/컨텍스트/a                                    |
| 클라이언트로부터 입력받기 | 요청<br />doGet (HttpServletRequest request, HttpServletResponse response)<br />String id = request.getParameter("id");<br />                => 정수라면, Integer.parseInt(id);<br />String [ ] = request.getParameterValues("fruits"); |
| db연동하기                | 처리<br />로그인, 회원가입, 게시물 조회<br />--> db 조회 / 저장 -> jdbc 필요<br />class A extends HttpServlet {<br />doGet(....){<br />//요청<br />jdbc  사용 방법 입력<br />//응답<br />} |
| 자바 클래스 연동하기      | 처리<br />xxxDAO = 각 기능별 1개의 메소드 생성 <br />xxxVO/xxxDTO) = 레코드 1개 표현하는 객체<br />ex)<br />xxxDAO dao = new xxxDAO();<br />? = dao.메소드명(?); |
| 다른 서블릿과 연동하기    | 처리 - 응답<br />RequestDispatcher rd = request.getRequestDispatcher("/b");<br />rd.include(request, response);<br />    or<br />rd.forward(Request, response);<br /> ==> tomcat에 요청<br />b.doGet |



### Servlet API

javax.servlet 패키지

javax.servlet.http.패키지

| javax.servlet.Servlet                        | 인터페이스                                                   |
| -------------------------------------------- | ------------------------------------------------------------ |
| **class GenericServlet implements Servlet**  | **클래스는 5개 메소드 오버라이딩**                           |
| **class HttpServlet extends GenericServlet** | **5개 메소드 오버라이딩 + doGet\|doPost ...**                |
|                                              |                                                              |
| **모든 서블릿 상속**                         | **HttpServlet**                                              |
| **모든 서블릿 오버라이딩**                   | **doGet**/doPost/doxxx<br />init/destroy<br />protected void doGet<br />  **(HttpServletRequest req, HttpServletResponse res)** |
| **클라이언트 요청 처리 객체**                | **HttpServletRequest**                                       |
| **클라이언트 응답 처리 객체**                | **HttpServletResponse**                                      |





메소드 (서블릿 호출시 자동 실행 순서)

| **doGet**   | **2. 호출(요청)할때마다 여러번 실행<br />      매번 요청시 처리 반복** |
| ----------- | ------------------------------------------------------------ |
| **doPost**  | **2. 호출할때마다 여러번 실행**                              |
| **service** | **2. 호출할때마다 여러번 실행**                              |
| **init**    | **1. 서버 시작 후 1번만 실행<br />     (서블릿 최초 초기화 수행 작업)** |
| **destroy** | **3. 서버 종료시 \|\| 서블릿 코드 수정 후 재컴파일 시<br />     (이전 서블릿 객체 삭제시)<br />     (서블릿 최초 초기화 수행 작업 결과 삭제)** |



### Servlet의 동작과정

- 서블릿 실행과정

1. url 입력 - http://127.0.0.1:9090/test/sample?id=test

2. 요청 분석

3. 매핑에 해당하는 서블릿 파일 찾기

4. 서블릿 컴파일

5. 실행

   5-1. 서블릿 객체를 메모리 생성

   5-2. 생성자 실행

   5-3. init 실행

   5-4. 요청정보 HttpServletRequest 객체생성

   ​		응답정보 HttpServletResponse 객체생성

   **5-5. doGet 실행**

   (5-1,2,3 = 클라이언트 요청 횟수, 클라이언트 개수와는 별개로 딱 1번만 실행됨)

6. **실행결과 클라이언트에 응답** 반복





### Get/ Post

| get                                                          | post                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| url 뒤 붙어서 전송<br />url? 변수명 1=값1&...<br />길이제한(파일전송불가)<br />보안취약<br /><form<br /><form method=get<br /><a herf="loginform"<br />  주소표시줄 입력<br />doGet | url 별도 분리 전송<br />한글인코딩 처리 메소드 호출<br />길이 무제한(파일전송)<br />보안 유리<br /><form method=post<br />doPost |



- 요청

  request.setCharacterEncoding("utf-8");

String --> request.getParameter("input name 속성값 1개입력");

String [] --> request.getParameterValues("input type="checkbox" 여러개 선택");

+ 응답

response.setContentType("text/html;charset=utf-8");

PrintWriter o = response.getWriter();

o.println("< h1>")

3> 입력양식 유도

< form action="sample" method="get">

< form action="sample">

4> 서블릿 doGet 호출(service 대신)

​	-post

​	1>< form action="sample" method="post">

​	2> 서블릿 doPost 호출(service 대신)



## Servlet 비즈니스 로직 처리



| logindb.html | LoginDBServlet                                               | MemberDAO                                   | MemberVO |
| ------------ | ------------------------------------------------------------ | ------------------------------------------- | -------- |
| id, password | 2개 파라미터 입력 요청<br />응답 3가지<br /> id o, pw x<br /> id o, pw o<br /> id x | getMember(String id, String password)<br /> |          |



select => db에 변화 x, 결과테이블 도출 > pt.executeQuery()



## 커넥션 풀

1. con tomcat server 시작시 미리 생성, 종료 시까지 사용

2. 일정갯수 미리 생성 - 커넥션 공유

3. dbcp 포함 라이브러리

4. 설정 ==>dbcp

    ```java
    <Context docBase="servlettest" path="/servlettest" reloadable="true" 
        source="org.eclipse.jst.jee.server:servlettest">
        <Resource type="javax.sql.DataSource" 
    	   name="jdbc/myoracle" 
    	   username="hr" 
    	   url="jdbc:oracle:thin:@127.0.0.1:1521:xe" 
    	   password="hr" 
    	   driverClassName="oracle.jdbc.driver.OracleDriver" 
    	   maxIdle="5" 
    	   MaxActive="5"/>
    </Context>
    ```

5. 서블릿 ==> javax.sql.DataSource 객체



## Context = html - servlet-db



+ servlet-servlet 호출

class Aservlet extends HttpServlet

doGet(request, response){

​		MemberDAO dao = new ..()

​		dao.메소드()

RequestDispatcher rd = request.getRequestDispatcher("/bservlet");

rd.include(request, response);// 이동(했다가 다시 돌아옴)

 || rd.forward(request, response); //이동(하면 다시 안돌아옴)

​		AServlet 남은 내용 처리

}

| logindb.html | LoginDBServlet('logindb')       |
| ------------ | ------------------------------- |
|              | MemberListServlet('memberlist') |
|              |                                 |

+ include/ forward





## 쿠키와 세션

- 서블릿 데이터 공유

| 쿠키                                                         | 세션                             |
| ------------------------------------------------------------ | -------------------------------- |
| 브라우저 종료시 / 종료 이후 지정된 시각까지                  | 브라우저 종료시 까지             |
| 공유 데이터 : 클라이언트 컴퓨터에 저장                       | 공유 데이터 : 서버 컴퓨터에 저장 |
| 문자열 저장 가능 (객체 x)<br />(인코딩 설정)<br /> :  영문, 숫자 = 그대로<br /> :  한글 = 인코딩 필요 | 자바 모든 객체 저장 가능         |
| 보안 취약<br />(영문 암호화)                                 | 보안 유리                        |
| 전송 데이터양 제한                                           | 데이터양 무제한                  |



| 쿠키                                                         |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 클라이언트 최초 요청<br /><br />4. 쿠키내용 브라우저 전송 | 2. 서버에서 쿠키 객체로 생성<br />      Cookie c = new Cookie("쿠키이름", "쿠키값");<br />      c.setMaxAge(60 * 60 * 24);<br />3. 클라이언트 응답<br />      response.addCookie(c); |
| 5. 클라이언트 2번째 요청<br />   (동일 서버로부터 받은 쿠키도 같이 전송)<br /><br /><br />4 반복 | 6. 클라이언트로부터 쿠키를 읽어온다<br />      Cookie[] coo = request.getCookies();<br />          coo[0].getName();<br />          coo[0].getValue();<br />2,3 반복 |

| 세션                                                         |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1. 클라이언트 최초 요청(로그인)<br /><br /><br /><br />      | 2. 처리 - 세션 데이터 저장 - 공유<br />     HttpSession session = request.getSession();<br />       false - 최초로 연결됨<br /><br />3. session.setAttribute("세션속성명", 값(Object type)); |
| 4. 클라이언트 요청(메일)<br /><br /><br />7.  응답           | 5. HttpSession session = request.getSession();<br />       true - 이전부터 연결 중이었음<br /><br />6. Object o = session.getAttribute("세션속성명");<br />       => 원래타입으로 형변환 필요시 가능 |
| 8. 클라이언트 요청(로그아웃 처럼 남겨놓은 정보 삭제)<br /><br /><br /> | 9. HttpSession session = request.getSession();<br />       true - 이전부터 연결 중이었음<br /><br />10. session.removeAttribute("세션속성명");<br />   \|\| session.invalidate(); -> 모든 attribute 삭제 |

*세션 속성값 삭제하는 방법

1. removeAttribute("속성") : 특정 속성 삭제

2. invalidate() : 모든 속성 삭제 (브라우저 종료 여부 관계x)

3.  **30분간** 액션이 없을 시 세션 종료 (브라우저 종료하지않아도)
   (datasource 설정 - Servers\server.xml => 세션 타임아웃 설정 변경 )
   (서블릿 url 매핑 - Webcontent\web.xml)

   ![image-20210830131522466](C:\Users\jjyju\AppData\Roaming\Typora\typora-user-images\image-20210830131522466.png)

4. 메소드 이용하여 session.setMaxInactiveInterval(30*60);

5. 브라우저 종료 시

   

# JSP

| 서블릿 (*.java)                                              | JSP (*.jsp)                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| class A extends HttpServlet<br />doGet(){<br />응답 - 자바언어 내부 html언어 포함형식<br />out.println("< h1 >..< /h1 >");<br />}<br />doPost | < % 자바문장들: (서블릿 api + db + DAO,VO 객체 생성 자바 문장) ; % ><br />< html ><br />< body ><br />Html 태그 양식 내부에 자바 문장 포함<br /><br />**JSP 태그와 HTML 태그 혼용** |
| 서블릿 api 사용처리                                          | 서블릿 api + html 언어 독립적                                |



* **서블릿과 jsp의 api**

| api 이름                     |                                                              |
| ---------------------------- | ------------------------------------------------------------ |
| 상속                         | javax.servlet.http.HttpServlet                               |
| 매개변수 선언                | javax.servlet.http.HttpServletRequest<br />javax.servlet.http.HttpServletResponse |
| 다른 서블릿 결과 포함 / 이동 | javax.servlet.RequestDispatcher<br /><br />request.setAttribute(" ", " ");<br />request.getAttribute(" ");<br />request.removeAttribute(" ");<br /> |
| 다른 서블릿 데이터 공유      | javax.servlet.http.Cookie<br />javax.servlet.http.HttpSession<br /><br />session.setAttribute(" ", " ");<br />session.getAttribute(" ");<br />session.removeAttribute(" ");<br /> |



Java Server Page(JSP)  =  html + java

​	작성 - 실행

​	1> servlet api + jsp api + 내장객체들

​	2> <%  %> : jsp 기본태그

​		 <jsp:  > : jsp 액션태그

​		 <c:     > : custom 태그

​		 ${  } : el

​	3> 1개 웹페이지 = servlet + jsp 연동

​	4> Spring

## jsp 태그 종류

| html       | 태그                                                         |
| ---------- | ------------------------------------------------------------ |
| html       | html, css, js, jquery                                        |
| **jsp**    | **태그**                                                     |
| jsp 기본   | 기본 태그 : <%  자바 문장   %><br />표현문 태그 : <**%=** 변수명(값)  %><br />선언문 태그 : <**%!** 메소드 정의, 필드변수 정의  %><br />jsp주석 태그 : <**%--**   %><br />지시문 태그 : <**%@**   %><br />   <%@ page import="  "   text/html; xharset-utf-8<br />   <%@ include<br />   <%@ taglib |
| jsp action | <jsp:xxxx     /><br /><jsp:include page="/a.jsp" -> 컨텍스트의 a.jsp<br /><jsp:forward page="a.jsp"-> 현재파일과 같은 경로의 a.jsp<br /><jsp:useBean id=" " class="패키지명. 클래스명" scope="request\|session"<br /><jsp:setProperty property=" " name=" " value/param="" /><br /><jsp:getProperty property=" " name=" " /> |
| jsp custom | <c:xxxx       />                                             |
| el         | ${  i  }                                                     |
| 내장객체   | jsp는 서블릿보다 간결하게 응답, servlet api 그대로 사용 가능<br />자바 문장의 구현을 없애자!<br />request - 요청<br />response/ out - 응답<br />exception - 예외처리 (<% page isErrorPage="true"인 곳에서만)<br />session - 세션 (브라우저 내부에서 데이터 공유)<br />application - 다른 브라우저에서도 공유(서버종료시 까지)..... |



JSP 스크립트 요소

선언문 : <%!	%> : 변수, 메소드 선언

스크립트릿 태그 : <%	%> : 자바 코드 작성

표현문 : <%=	%> : 변수 값 출력





### 내장객체

1> <%!	%> 태그 제외 나머지 모든 jsp 내용은 _jspService() 실행 코드

2> _jspService() 지역변수 취급

| 내장객체 이름   | 타입                                                         | 역할                                                         |
| --------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **request**     | javax.servlet.http.HttpServletRequest                        | 요청                                                         |
| **response**    | javax.servlet.http.HttpServletResponse                       | 응답                                                         |
| **out**         | javax.servlet.jsp.JspWriter(PrintWriter 하위)                | 응답출력객체                                                 |
| **session**     | javax.servlet.http.HttpSession                               | 브라우저 내부 정보 공유                                      |
| page            | java.lang.Object( 자바 클래스 this 같은 역할)                | 현재 jsp 객체                                                |
| pageContext     | javax.servlet.jsp.PageContext                                | 현재 jsp 내장객체 조회 객체                                  |
| config          | javax.servlet.ServletConfig                                  | web.xml 파일 변수 저장하고 jsp파일에서 사용                  |
| **application** | javax.servlet.ServletContext<br />   application.getAttribute("변수");<br />   application.setAttribute("변수", ".."); | 현재 컨텍스트의 모든 jsp 파일 공유<br />(브라우저 종료 이후에도 사용 가능)<br />(서버종료 시에만 진짜 종료) |
| **exception**   | java.lang.Throwable                                          | 예외객체                                                     |

request.setAttribute("", ""); => 포함/이동 서블릿/jsp까지만 공유

session.setAttribute("", ""); => 브라우저 서블릿/jsp 종료까지 공유

application.setAttribute("", ""); => 다른 서버 종료에도 공유 가능



#### exception 예외 처리

| a.jsp<br /><%@ page errorPage="c.jsp"<br />예외발생시 - c.jsp 이동 - 처리<br />예외발생x - a.jsp 수행 | c.jsp(예외처리 전담jsp)<br /><%@ page isErrorPage="true"<br />exception 내장객체 사용가능<br />예외타입별, 오류발생파일명 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| **b.jsp<br /><%@ page errorPage="c.jsp"**                    |                                                              |



### 액션태그

#### include/forward

+ servlet

RequestDispatcher rd = request.getRequestDispatcher("/b or b.jsp");

rd.include(request. response);

rd.forward(request. response);

+ jsp

<jsp:include page="b.jsp" />

<jsp:forward page="b.jsp" />



#### useBean/setProperty/getProperty

+ servlet

```html
<%@ page import="vo.MemberVO">
<% MemberVO vo = new.MemberVO("", "", "", "");
   vo.setMemberid("member1");
   vo.setxxx();
%>
<%=vo.getMemberid() %>
```

+ jsp

```jsp
<jsp:useBean id="vo" class="MemberVO" />

<jsp:setProperty name="vo" property="memberid" value="member1"  />

<jsp:getProperty name="vo" property="memberid"/>
```

setProperty 에서, 

property와 form input request parameter 이름이 동일하면 생략 가능하다 



### 표현언어 el

= expression language

브라우저 응답 내용 쉽고 간결하게 표현 가능한 언어

JSP 파일 내부에서 사용



#### 표현언어 el 자료형

논리값 - true/ false

정수/실수

문자열 - 'aaaa', "aaaa"

null

(html, sql => 대소문자 구분 x)

(js, jquery, java, servlet, jsp, el => 대소문자 구분 o)



#### 표현언어 el 연산자



#### 표현언어 el 내장객체

!= jsp 내장객체

| jsp 내장객체 | el 내장객체                                     |
| ------------ | ----------------------------------------------- |
| x            | param.파라미터명<br />paramValues.파라미터명[i] |
| pageContext  | pageScope => 가장 우선적인 객체                 |
| request      | requestScope                                    |
| session      | sessionScope                                    |
| application  | applicationScope                                |



//**빈 사용 실습**

빈 = jsp bean



<jsp:useBean id="vo" class="vo.MemberVO" scope="request" />

<jsp:setProperty name="vo" property="memberid" value=""  param=""  />

<jsp:getProperty name="vo" property="memberid"/>



### JSTL

= jsp standard tag library 

-> 라이브러리 파일 추가 설치후 사용가능 태그들

1. WEB-INF 파일 내 jstl-1.0.jar 넣기
2. <%@ taglib prefix="c" uri="h ttp://java.sun.com/jsp/jstl/core" %> 추가

|                                   |                                                              |
| --------------------------------- | ------------------------------------------------------------ |
| <c:set<br /><c:out<br /><c:remove |                                                              |
| <c:if                             | <c:if test="${10>20}" ->false  />                            |
| <c:choose                         | < c:choose><br /><c:when test="${10<20}" ><br />조건 만족시 수행<br />< /c:when><br /><c:when test="${10>20}" ><br />조건 만족시 수행<br />< /c:when><br />...<br /><c:otherwise ><br />위 조건 만족하지 않는 경우 수행<br />< /c:otherwise><br />< /c:choose> |
| <c:forEach                        | <c:forEach<br />begin="1"<br />end="100"<br />step="1"<br /><br /><c:forEach<br />items="배열 리스트 "<br />var="1개 데이터"<br />><br />${vo.XXX}<br />< /c:forEach> |





# Spring

+ sts 툴 설치 (spring tool suite)

  eclipse => jsp servlet jdbc 실행

  sts => jsp servlet jdbc + spring + mybatis
  
  

+ spring Framework의 특징

  1> 자바로 구현된 대표적인 프레임워크 툴
  
  2> ioc, di, aop, mvc, 다른 프레임워크 연동
  
  3> 경량의 컨테이너
  
  4> pojo 클래스 사용 (dao, vo, service)
  
  5> ioc di 기능으로 spring =객체 생성, main= 생성된 객체 전달
  
  

| Inteface TV<br />powerOn()<br />powerOff()<br />soundUp()<br />soundDown() |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| SamsungTV implements TV                                      | LgTV implements TV                                           |
| TVFactory<br />TV getTV(String name)                         | TVMain<br />1> TV 객체 변경시에도 기능 메소드 수정할 필요 x<br />2> TVFactory가 전달하는 TV 객체 사용 가능<br />3> TVFactory에 의존<br />4> 소스코드 변경시 다른 부분 변경 최소화 |

1> 여러가지 클래스에 규칙을 강제화

2> TV 객체 변경시에도 기능 메소드 수정할 필요 x

​	 TV tv = xxxxTV();



## IOC 제어역행

=Inversion Of Control

+ 제어의 역전

=>기본적으로, main 메소드에 객체 생성 제어권 有

=> TVFactory가 객체 생성 제어권 가지고 main은 이에 의존하게 만듬 = 제어의 역전

=> 객체타입 한정 --> TV 인터페이스 구조 사용



## DI 의존성 주입

=Dependency Injection

main메소드가 TVFactory에 의존하여 TVFactory가 생성한 객체만을 주입받는다 

| Inteface TV<br />powerOn()<br />powerOff()<br />soundUp()<br />soundDown() |                                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| SamsungTV implements TV                                      | LgTV implements TV                                           |
| spring<br />factory 역할 api                                 | TVMain<br />spring 프레임워크에서 di받아서 전달되는 객체 사용 |
| spring bean configuration xml<br /><br /> bean - jsp 자바객체<br /> spring bean - spring 자바객체 | 스프링 설정파일                                              |

+ 구현 방법

1> 생성자를 통해 객체 주입 (생성자 di)

2> setter 메소드를 통해 객체 주입 (setter di)



## Spring annotation

| ioc/ di/ xml 태그방식                  | Annotation 방식                                              |
| -------------------------------------- | ------------------------------------------------------------ |
| <bean id="a" class="ss.A"              | **@Component("a")**<br />class A {}                          |
| <bean id="a" class="ss.xxxServiceImpl" | **@Service("a")**<br />class xxxServiceImpl implements xxxService {} |
| <bean id="a" class="ss.ADAO"           | **@Repository("a")**<br />class ADAO {<br />    **@Autowired**<br />     AVO vo;<br />}<br />@Component<br />class AVO{}<br /><br />**@Repository**<br />class BDAO{} |
| <property                              | @Autowired                                                   |
| <property                              | @Qualifier                                                   |
| <constructor-arg                       |                                                              |

+ Service 추가하기

  dao - 메소드 1개 단위 = sql 1개(insert/select) 실행단위

  login(){ selectMember() }

  register(){ selectMember() 후 insertMember() }



1> spring pojo(dao, vo, service) 구현한다

2> 서로다른 클래스 공통 메소드 필요 - 인터페이스

3> spring 연결 - xml

​	3-1. xml

​		<bean <property <constructor-arg

​	3-2. 자바

​		@WebSerclet("/a") --> WebServlet annotation --> 클래스 선언부

​			annotation = 자바 실행 환경(jdk, tomcat, spring)으로 알려주는 설명



## Spring MVC

스프링 필수 기능 ioc, di => aop, mvc, jdbc, 프레임워크 연동

+ mvc란?

  =Model View Controler

  ​     모델 2 : servlet + jsp  구조

  ​      **A servlet** = 클라이언트 요청 분석 + 처리 **DAO/VO/Arraylist** 등 메소드 결정 + 응답 **JSP** 결정

  ​      (Controller)                                                    (Model)													(View)

  

+ Spring mvc

  = mvc를 강제화

  = Front controller + mvc



| MVC - Dynamic Web Project        |                                                              |
| -------------------------------- | ------------------------------------------------------------ |
| DispatcherServlet                | 클라이언트 모든 요청 집중 수령  ("/")<br />Frontcontroller 역할<br />요청 수령 후 view 로 이동 |
| HandlerMapping                   | 특정 url - 컨트롤러 mapping 정보<br />hello.spring - new HelloController()<br />a.spring - new AController() |
| Controller 인터페이스            | 메소드 HelloController가 오버라이딩                          |
| HelloController<br />AController | 특정 url - model, view 설정                                  |
| hello.jsp<br />a.jsp             | 응답                                                         |

DispatcherServlet -> HandlerMapping -> (Controller override)HelloController -> view : hello.jsp



| MVC - Spring                                          | 스프링 프로젝트 폴더 구조가 다름    |
| ----------------------------------------------------- | ----------------------------------- |
| DispatcherServlet                                     | X - spring api                      |
| HandlerMapping                                        | X - spring api                      |
| Controller 인터페이스                                 | X - spring api                      |
| HelloController<br />AController                      | src/main/java                       |
| hello.jsp<br />a.jsp                                  | src/main/webapp/WEB-INF/views       |
| dao, vo                                               | src/main/java                       |
| spring mvc 설정 <br />webxml<br />servlet-context.xml | src/main/webapp/WEB-INF/app-Servlet |



**MVC annotation**

@Controller : 지정 클래스를 컨트롤러로 자동 변환

@RequestMapping(" ") : 컨트롤러클래스 내부 메소드에 매핑

@RequestParam

@ModelAttribute





= 

   Context root = dynamic web project 이름



| sts4툴의 특성            |                                           |
| ------------------------ | ----------------------------------------- |
| dynamic web project 이름 | http:// ip:port/ dynamic web project 이름 |
| spring project 이름      |                                           |





CRUD 기능

create / read / update / delete

기능 수행 메소드들을 1개의 컨트롤러 안에 넣기

@Controller

class BoardController{ //게시판 관련

​	@RequestMapping("/write.board")

​	글 저장 메소드(){}

​	@RequestMapping("/detail.board")

​	상세조회 메소드(){}

​	@RequestMapping("list.board")

​	글 리스트 메소드(){}

​	@RequestMapping("/update.board")

​	글 수정 메소드(){}

​	@RequestMapping("/delete.board")

​	글 삭제 메소드(){}

}



예제1. LoginController



login.html => LoginServlet => login.result.jsp

form				입력-처리			출력



http:// localhost:9090/multi/loginform

loginform.jsp --> loginresult 전송

url => DispatchedServlet 수령 => servlet-context.xml (매핑, @...)



#### @Controller

class A

​	@RequestMapping("/loginform")

​	login 메소드 실행

​	return "loginform";

--> /web-inf/views/loginform.jsp

​	@RequestMapping("/loginresult")

​	loginresult 메소드 실행

​	

컨트롤러 메소드의 매개변수 자유롭다

| 서블릿 api                  | HttpSession... 그대로 사용                                   |
| --------------------------- | ------------------------------------------------------------ |
| **자바 데이터 타입의 변수** | **요청 파라미터 이름과 동일한 이름의 변수 자동 저장<br />타입변환 자동<br />@RequestParam**("요청파라미터이름") |
| **자바 객체**               | **@ModelAttribute("JSP이름") LoginVO**                       |

컨트롤러 메소드의 리턴타입 자유롭다

| ModelAndView | Model, view 이름 설정                                        |
| ------------ | ------------------------------------------------------------ |
| **void**     | **@RequestMapping("uri")<br />uri 같은 이름의 뷰 설정<br />model 없다** |
| **String**   | **model 없다<br />뷰이름 설정<br />return "a"; --> WEB-INF/views/a.jsp<br />return "redirect:/a" --> 컨트롤러 내부 다른 메소드 호출<br />/a의 url 가진 @RequestMapping 찾아가란 뜻** |



| Spring  mvc 실행흐름 |                                                              |
| -------------------- | ------------------------------------------------------------ |
| 1. web.xml           | 기본설정 : **"/" - 모든 url은 DispatcherServlet로 연결한다는 뜻**<br />(..servlet-context.xml)<br />요청값 한글 인코딩 설정 |
| servlet-context.xml  | 기본설정 : **view 저장경로 / 확장자 .jsp**<br />@xxx 설정 인식 패키지 설정 |

+ 모델 2 방식 = servlet+jsp 구조

  Servlet = Controller

  DAO = Model

  JSP = View

+ Spring MVC = mvc + front controller 구조

  요청 1 - c - m - v - 응답1

  요청 2 - c - m - v - 응답2

  .....

### get/Post

http에 요청하는 방식

| get                                                          | post                                                 |
| ------------------------------------------------------------ | ---------------------------------------------------- |
| <form action="/..." method="get"<br /><a href="컨트롤러매핑url"<br />@Controller | html 파일 내부<br/><form action="/..." method="post" |



### resource 폴더 사용하기

|                                                              |                                                   |
| ------------------------------------------------------------ | ------------------------------------------------- |
| src/main/java<br />(Spring - classpath)                      | 컨트롤러<br />패키지명.xxx<br />(@인식 설정 필요) |
| webapp/WEB-INF/views                                         | 폴더. * .jsp                                      |
| webapp/resources<br />(mvc와 무관하게 실행 가능)<br />(servlet-context.xml 파일 내 정의) | html<br />* .css<br />* .js                       |



### 비즈니스 로직과 mvc연동

1> web.xml에 필요한 로직이 있는 xml 추가 

```xml
<!-- The definition of the Root Spring Container shared by all Servlets and Filters -->
<context-param>
		<param-name>contextConfigLocation</param-name>
			<param-value>
			/WEB-INF/spring/root-context.xml
			classpath:annotation/service/member/member.xml
			</param-value>
</context-param>
```

2> 비즈니스 로직 처리

 xxxxController

@Autowired

xxxxService service;



### 파일 업로드 기능

> 28장, 27장

(클라이언트)

1> HTML 태그 업로드 기능 사용

​	< form action="..."    **method="post"**     **enctype="multipart/form-date"**

​	<input type="file"  



(spring api)서버파일에서 업로드된 파일을 전송받는 기능

2> pom.xml     ==> https://mvnrepository.com 여기서 기능별 라이브러리 검색

​	스프링 라이브러리 관리 : file upload / ajax / mybatis .... 추가 라이브러리 관리

​	하기 2개의 jar 파일의 라이브러리 다운로드 후 dependency 태그로 pom.xml에 추가

​	( commons-fileupload.jar, commons-io.jar )

```xml
pom.xml

<!-- 파일 업로드 -->
<!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload -->
<dependency>
    <groupId>commons-fileupload</groupId>
    <artifactId>commons-fileupload</artifactId>
    <version>1.3.1</version>
</dependency>

<!-- https://mvnrepository.com/artifact/commons-io/commons-io -->
<dependency>
    <groupId>commons-io</groupId>
    <artifactId>commons-io</artifactId>
    <version>2.6</version>
</dependency>

```

3> servlet-context.xml에 multipart 선언

3. 파일업로드- Multipart - 인식태그

```xml
<beans:bean id="multipartResolver" 
	class="org.springframework.web.multipart.commons.CommonsMultipartResolver" />
```

4> input type= file name="f" > ------> MultipartFile f 매 개 변 수로 선 언

5> MultipartFile 메소드
	getOriginalFilename()--> 전송 파일명
	transfer();--> 서 버 내부 내 용 저 장

-----



### Restful 기능 mvc

> 오늘날, 기기가 다양해 지면거 화면크기가 다양해짐.
>
> 화면에 너무 많은 내용이 들어가면 안됨
>
> 기본화면 구성 + 추가내용이 동적으로 변경 가능하게 함
>
> ex) Google Maps 

+ http 특징

  + 요청 - 응답 - 요청 - 응답

  + 기본적인 요청 처리 시간동안 클라이언트는 대기. 화면에 변화 없음

    응답 후 전체 화면 변화

    ====> 동기화 통신 방식(synchronous)

+ **ajax** (asynchronous javascript and xml) 

  + 화면 전체 구성하고 요청 - 응답 - 화면 **일부** 변경

    ====> 비동기 통신 방식(asynchronous)

  + javascript(비동기통신시 전달 초기 데이터 형태)

  + xml(비동기통신시 전달 )

**json** (java script object notation) 자바스크립트 객체형태

-> {"변수명" : "값", "변수명" : "값"}



1> pom.xml
ajax 하려면 우리가 컨트롤러에서 리턴하는 자바 객체를 자동으로 json 으로 변환해주는 라이브러리 필요

2> $.ajax / @ResponseBody



### Spring xml 파일들

|                     |                                                              |
| ------------------- | ------------------------------------------------------------ |
| pom.xml             | spring mvx project root<br />스프링 라이브러리 다운로드, 버전 설정 |
| web.xml             | src/main/webapp/WEB-INF/<br />웹 관련 설정<br />(스프링 시작 이전)<br />1> url => 스프링 DispatcherServlet<br />2> encoding utf-8 설정<br />3> 스프링 전달 추가 설정 xml 정보 |
| servlet-context.xml | src/main/webapp/WEB-INF/spring/appServlet<br />스프링 관련 각종 설정 <br />1> view 경로와 확장자<br />2> html과 같은 정적 요소들 - html, css, js, image 경로<br />3> <context: component-scan로 annotation적용 파일 설정 |





# Mybatis

> 23장

### 스프링과 my batis

| Spring 프레임워크                                            | mybatis 프레임워크                                           |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| java 기반                                                    | java 기반                                                    |
| 통합기능<br />ioc di + **mvc** + aop <br />+ db연동 + **다른 프레임워크 연동**<br />DAO, VO 코드 그대로 = 비즈니스 로직 | 단일 기능<br /><br />**db 연동**                                           <br /> |

#### 	mybatis DB 연동

| jdk jdbc                                                     | spring jdbc      | mybatis ***                                                  |
| ------------------------------------------------------------ | ---------------- | ------------------------------------------------------------ |
| java.sql.*                                                   | 스프링 제공 jdbc | jdbc 프레임워크                                              |
| 1> 코드 반복이 심하다<br />2> sql 변경시 자바코드도 같이 변경  <br />3> connectionpool 수동선택<br />      => 연결유지 어려움 |                  | 1> xml 설정<br />      sql 문장 자바코드 제거 (xml에 별도로 설정)<br />2> connectionpool, sql 실행객체 자동 생성/관리<br />3> sql 조회 결과를 정한 타입으로 설정 가능<br />      (String/MemberVO/ ArrayList 등 ) |

### mybatis Oracle 연동

mybatis-config.xml(시작 설정 정보)

|                        |                                                              |
| ---------------------- | ------------------------------------------------------------ |
| 객체 type 설정         | <typeAlias                                                   |
| 연결할 DataSource 설정 | <environment <br />다중환경을 설정할 수 있지만 <br />SqlSessionFactory 인스턴스마다 한개만 사용 가능 |
| mapper 파일 설정       | <mapper                                                      |



sql-mapping.xml

|               |                                                              |
| ------------- | ------------------------------------------------------------ |
| select        | id="자바sql 실행 식별자"<br />resultType<br />parameterType  |
| insert        | id=필수<br />resultType 없다                                 |
| update        | id=필수<br />resultType 없다                                 |
| delete        | id=필수<br />resultType 없다                                 |
| forEach       | 다른 태그 포함 반복 - sql 문법 숙지                          |
|               |                                                              |
| resultType    | XXXVO<br />int<br />String<br />조회된 결과를 나타낼 수 있는 객체를 표시하는 곳 |
| parameterType | XXXVO<br />int<br />String<br />int[]                        |



# Spring 과 mybatis 연동

| Spring xml 파일들                      |                                                              |
| -------------------------------------- | ------------------------------------------------------------ |
| pom.xml                                | spring mvx project root<br />스프링 라이브러리 다운로드, 버전 설정<br />maven dependency<br /> |
| **web.xml**                            | src/main/webapp/WEB-INF/<br />웹 관련 설정<br />(스프링 시작 이전)<br />1> url  -> 스프링 DispatcherServlet 호출<br />2> encoding utf-8 설정   -> 한글 인코딩 설정<br />**3> 스프링 전달 추가 설정 xml 정보** |
| servlet-context.xml                    | src/main/webapp/WEB-INF/spring/appServlet<br />스프링 mvc 설정 <br />1> view 경로와 확장자<br />2> html과 같은 정적 요소들 - html, css, js, image 경로<br />3> <context: component-scan로 annotation적용 파일 설정 |
| 추가설정 xml<br />**mybatis 연동 xml** | web.xml에 등록 필요                                          |

+ mybatis = config.xml + mapping.xml

|                                     |                                                              |
| ----------------------------------- | ------------------------------------------------------------ |
| mybatis-config.xml                  | 데이터 소스생성<br />타입, 매퍼파일                          |
| mapper.xml                          | sql 정의                                                     |
| **스프링+마이바티스 연동 설정 xml** | **스프링 bean 설정 파일<br />ioc, di 설정**                  |
| servlet-context.xml                 | spring mvc 설정                                              |
| web.xml                             | 웹서버 설정                                                  |
| pom.xml                             | 4개의 라이브러리 jar 파일<br />mybatis.jar<br />ojdbc.jar<br />mybatis-spring.jar<br />spring-jdbc.jar |



<img src="C:\Users\jjyju\AppData\Roaming\Typora\typora-user-images\image-20210908102753631.png" alt="image-20210908102753631" style="zoom: 67%;" />

1. DataSource 생성 ---> mybatis-config.xml 설정 삭제
2. SqlSessionFactory 생성
   - mybatis-config.xml
   - sql-mapping.xml 
   - 1에서 만든 datasource 객체

3. SqlSessionTemplate 생성  ---> xxxDAO 전달
4. <context:component-scan ....>



### Spring 에서 main 없애고 mvc 구조로 만들기

> Spring mvc + mybatis

|                                     |                                                              |
| ----------------------------------- | ------------------------------------------------------------ |
| mybatis-config.xml                  | 타입 Alias                                                   |
| mapper.xml                          | sql 정의                                                     |
| **스프링+마이바티스 연동 설정 xml** | **스프링 bean 설정 파일<br />ioc, di 설정<br />datasource<br />sqlSession** |
| servlet-context.xml                 | spring mvc 설정                                              |
| web.xml                             | 웹서버 설정                                                  |
| pom.xml                             | 4개의 라이브러리 jar 파일<br />mybatis.jar<br />ojdbc.jar<br />mybatis-spring.jar<br />spring-jdbc.jar |





# Spring Boot

> spring mvc => xml 설정 多 + 라이브러리 설정 多 + 자바구현 실행 
>
> spring boot => 자바 구현 실행에 집중할 수 있게 xml, 라이브러리 등의 설정 간소화 목적
>
> 그럼에도 불구하고 mvc의 원리를 알아야 부트의 원리를 이해할 수 있음

##### 스프링 부트 특징

- pom.xml 파일이 없고 부트에서 자동으로 설정함
- @SpringBootApplication 이 설정된 main메소드 클래스 실행시 부트 시작
- run - spring boot app으로 실행
- tomcat은 main 시작시 자동으로 실행되나 오류 발생시, 포트번호 확인해봐야함
- web.xml 없고 SpringBootServletInitializer 클래스가 대신함
- src/main/resources/**application.properties**에서 대부분 xml설정을 대신함
- jsp가 기본 view가 아니기 때문에 따로 설정을 해야한다 -> 폴더 수동생성 및 application.properties에 노티



```xml
<!-- for jsp -->
	<dependency>
        <groupId>org.apache.tomcat.embed</groupId>
        <artifactId>tomcat-embed-jasper</artifactId>
        <scope>provided</scope>
    </dependency>
<!-- for jsp jstl -->
    <dependency>
        <groupId>javax.servlet</groupId>
        <artifactId>jstl</artifactId>
    </dependency>
<!--톰캣 재시작을 도와주는 라이브러리-->
    <!--for tomcat restart -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
            <optional>true</optional>
        </dependency>

```



### Spring boot ajax 실행

```xml
<!--spring mvc에서 pom.xml 에 ajax 사용하기위해 라이브러리 추가했음
	부트에서는 필요없음-->

```



### Spring boot annotation

|                                                            |                                                              |
| ---------------------------------------------------------- | ------------------------------------------------------------ |
| @SpringBootApplication                                     | 스프링 부트 시작 클래스<br />main 메소드                     |
| @ComponentScan(basePackageClasses =UploadController.class) | UploadController 패키지 스캔                                 |
| @ComponentScan                                             | 현재 패키지 스캔                                             |
| @Configuration                                             | 특정 파일을 외부 폴더에 저장하고 <br />해당 외부 폴더를 웹서버에 등록 설정 |



### Spring boot에서 Mybatis 실행

| Spring mvc                                                   | Spring boot                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| pom.xml 내<br />4개 <dependency 태그><br />=> oracle 1개, mybatis 1개, spring+mybatis 연동 2개 | Spring boot starter 항목 설정<br />spring web<br />+<br />jdbc api<br />oracle driver<br />mybatis |
| spring-mybatis.xml<br />=> 스프링 + 마이바티스 연동<br />=> db 연결, mapping 파일정보, <context:component-scan 태그 | application.properties 파일                                  |
| mybatis-config.xml<br />=> 클래스의 alias 정보               | 그대로 사용                                                  |
| sql-mapping.xml                                              | 표현방법 수정필요<br />sql 매핑 그대로 사용                  |
| web.xml<br />spring-mybatis.xml 이 연동관련설정 등록         | 불필요                                                       |
| servlet-context.xml<br /><context:component-scan ...><br />jsp 확장자/경로<br />html 경로<br /><br />파일업로드 api MultipartResolver | @ComponentScan 대신 사용<br />application.properties 폴더 반영<br />resources/static 폴더반영<br />부트 내장 |



-----

# 버전관리

## 	Git

### 		용어

+ Repository : 
  + Local Repository  (내컴퓨터)
  + Remote Repository (깃헙 저장소 )
+ add :
  + 
+ commit :
  + workspace == github 이용 ==> local repository
+ push :
  + local repository ==> remote repository
+ pull : 
  +  remote repository ==> local repository
+ branch : Root프로젝트로부터 파생된 프로젝트. 독립된 working directory
+ HEAD
+ checkout



서버실행중일땐 업로드 못함

​	

